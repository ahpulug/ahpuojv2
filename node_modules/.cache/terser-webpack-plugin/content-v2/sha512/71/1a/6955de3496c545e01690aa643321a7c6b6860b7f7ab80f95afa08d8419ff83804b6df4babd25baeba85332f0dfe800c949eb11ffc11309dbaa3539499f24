{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{558:function(e,t,a){\"use strict\";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"admin-content\"},[a(\"div\",{staticClass:\"content__breadcrumb\"},[a(\"el-breadcrumb\",{attrs:{separator:\"/\"}},[a(\"el-breadcrumb-item\",{attrs:{to:{name:\"adminIndex\"}}},[e._v(\"首页\")]),a(\"el-breadcrumb-item\",[e._v(e._s(e.$route.meta.title))])],1)],1),a(\"div\",{staticClass:\"content__main\"},[a(\"div\",{staticClass:\"content__searchbar__wrapper\"},[a(\"el-input\",{staticStyle:{\"max-width\":\"20em\"},attrs:{placeholder:\"请输入用户名或昵称\",maxlength:\"20\",clearable:\"\"},model:{value:e.queryParam,callback:function(t){e.queryParam=t},expression:\"queryParam\"}}),a(\"el-button\",{attrs:{icon:\"el-icon-search\",type:\"primary\",plain:\"\"},on:{click:e.fetchUserList}}),a(\"el-select\",{on:{change:e.fetchUserList},model:{value:e.userType,callback:function(t){e.userType=t},expression:\"userType\"}},[a(\"el-option\",{attrs:{label:\"普通用户\",value:0}}),a(\"el-option\",{attrs:{label:\"比赛用户\",value:1}})],1)],1),a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.loading,expression:\"loading\"}],staticStyle:{width:\"100%\"},attrs:{data:e.tableData}},[a(\"el-table-column\",{attrs:{label:\"ID\",prop:\"id\",width:\"180\"}}),a(\"el-table-column\",{attrs:{label:\"用户名\",prop:\"username\",width:\"180\"}}),a(\"el-table-column\",{attrs:{label:\"昵称\",prop:\"nick\"}}),a(\"el-table-column\",{attrs:{label:\"状态\",width:\"180\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"span\",{staticClass:\"text-button\",class:[0==t.row.defunct?\"text-button--success\":\"text-button--danger\"]},[e._v(e._s(0==t.row.defunct?\"启用\":\"禁用\"))])]}}])}),a(\"el-table-column\",{attrs:{label:\"操作\",width:\"180\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-button\",{attrs:{size:\"mini\",type:\"warning\"},on:{click:function(a){return e.handleChangePass(t.row)}}},[e._v(\"修改密码\")]),a(\"el-button\",{attrs:{size:\"mini\",type:0==t.row.defunct?\"danger\":\"success\"},on:{click:function(a){return e.handleToggleUserStatus(t.row)}}},[e._v(e._s(0==t.row.defunct?\"禁用\":\"启用\"))])]}}])})],1),a(\"el-pagination\",{attrs:{\"current-page\":e.currentPage,\"page-sizes\":[10,20,30,40,50],\"page-size\":10,layout:\"total, sizes, prev, pager, next, jumper\",total:e.total},on:{\"size-change\":e.handleSizeChange,\"current-change\":e.fetchUserList,\"update:currentPage\":function(t){e.currentPage=t},\"update:current-page\":function(t){e.currentPage=t}}})],1),a(\"el-dialog\",{attrs:{title:\"修改密码\",visible:e.dialogFormVisible,width:\"400px\",\"close-on-click-modal\":!1},on:{\"update:visible\":function(t){e.dialogFormVisible=t},closed:e.closeDialog,opened:e.openDialog}},[a(\"el-form\",{ref:\"form\",attrs:{model:e.form,rules:e.rules},nativeOn:{submit:function(e){e.preventDefault()}}},[a(\"el-form-item\",{attrs:{label:\"新密码\",prop:\"password\"}},[a(\"el-input\",{ref:\"input\",attrs:{autocomplete:\"off\"},nativeOn:{keyup:function(t){return!t.type.indexOf(\"key\")&&e._k(t.keyCode,\"enter\",13,t.key,\"Enter\")?null:e.submit(t)}},model:{value:e.form.password,callback:function(t){e.$set(e.form,\"password\",t)},expression:\"form.password\"}})],1)],1),a(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{on:{click:e.cancel}},[e._v(\"取消\")]),a(\"el-button\",{attrs:{type:\"primary\",\"native-type\":\"submit\"},on:{click:e.submit}},[e._v(\"确定\")])],1)],1)],1)};s._withStripped=!0;var r=a(0);var n={data:()=>({loading:!0,currentPage:1,currentRowId:0,perpage:10,total:0,queryParam:\"\",userType:0,dialogFormVisible:!1,form:{password:\"\"},rules:{password:[{required:!0,message:\"请输入新的用户密码\",trigger:\"blur\"},{pattern:/^[\\x00-\\xff]+$/,message:\"密码只能包含ascii字符\",trigger:\"blur\"},{min:6,message:\"密码最少为6位\",trigger:\"blur\"},{max:20,message:\"超出长度限制\",trigger:\"blur\"}]},tableData:[]}),mounted(){this.fetchUserList()},methods:{async fetchUserList(){const e=this;e.loading=!0;try{let i=(await(t=e.currentPage,a=e.perpage,s=e.userType,n=e.queryParam,Object(r.a)(\"GET\",\"admin/users\",{page:t,perpage:a,userType:s,param:n}))).data;setTimeout(()=>{e.tableData=i.data,e.total=i.total,e.loading=!1},200)}catch(e){console.log(e)}var t,a,s,n},handleSizeChange(e){this.perpage=e,this.fetchUserList()},openDialog(){this.$refs.form.clearValidate(),this.$refs.input.focus()},closeDialog(){this.$refs.form.resetFields(),this.$refs.input.blur(),this.form.name=\"\"},handleChangePass(e){console.log(e),this.currentRowId=e.id,this.dialogFormVisible=!0},submit(){const e=this;e.$refs.form.validate(async t=>{if(!t)return!1;try{let t=await function(e,t){return Object(r.a)(\"PUT\",`admin/user/${e}/pass`,t)}(e.currentRowId,e.form);e.$message({message:t.data.message,type:\"success\"})}catch(t){e.$message({message:t.response.data.message,type:\"error\"})}e.dialogFormVisible=!1})},cancel(){this.dialogFormVisible=!1},async handleToggleUserStatus(e){const t=this;let a=`确认要${0==e.defunct?\"禁用\":\"启用\"}用户${e.username}吗?`;try{await t.$confirm(a,\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"});try{let a=await(s=e.id,Object(r.a)(\"PUT\",`admin/user/${s}/status`));t.$message({type:\"success\",message:a.data.message}),e.defunct=!e.defunct}catch(e){t.$message({type:\"error\",message:e.response.data.message})}}catch(e){t.$message({type:\"info\",message:\"已取消操作\"})}var s}}},i=a(2),l=Object(i.a)(n,s,[],!1,null,\"ae066f2a\",null);l.options.__file=\"web-admin/js/pages/user_list/index.vue\";t.default=l.exports}}]);","extractedComments":[]}